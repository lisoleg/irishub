{"version":3,"sources":["../../../../../src/modules/common/relayers/libs/starportSigningClient.js"],"names":["StarportSigningClient","signerAddress","messages","fee","memo","tx","result","error","JSON","parse","message","code","data","txHash","i","tmClient","hash","prove","res","height","rawLog","log","console","SigningStargateClient"],"mappings":";;;;;;;;;AAAA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;IAEqBA,qB;;;;;;;;;;;;;;sFACpB,iBAAuBC,aAAvB,EAAsCC,QAAtC,EAAgDC,GAAhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqDC,gBAAAA,IAArD,2DAA4D,EAA5D;AAAA,6IAC+BH,aAD/B,EAC8CC,QAD9C,EACwDC,GADxD,EAC6DC,IAD7D;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;iFAGA,kBAAkBC,EAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8GAGmCA,EAHnC;;AAAA;AAGEC,gBAAAA,MAHF;AAAA,kDAISA,MAJT;;AAAA;AAAA;AAAA;AAAA;AAOOC,gBAAAA,KAPP,GAOeC,IAAI,CAACC,KAAL,CAAW,aAAEC,OAAb,CAPf;;AAAA,sBAQOH,KAAK,CAACI,IAAN,IAAc,CAAC,KAAf,IAAwBJ,KAAK,CAACK,IAAN,IAAc,oDAR7C;AAAA;AAAA;AAAA;;AASQC,gBAAAA,MATR,GASiB,oBAAOR,EAAP,CATjB;AAUQS,gBAAAA,CAVR,GAUY,CAVZ;;AAAA;AAAA,sBAWWA,CAAC,GAAG,EAXf;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA,uBAasB,KAAKC,QAAL,CAAcV,EAAd,CAAiB;AAChCW,kBAAAA,IAAI,EAAEH,MAD0B;AAEhCI,kBAAAA,KAAK,EAAE;AAFyB,iBAAjB,CAbtB;;AAAA;AAaUC,gBAAAA,GAbV;AAAA,kDAiBa;AACNC,kBAAAA,MAAM,EAAED,GAAG,CAACC,MADN;AAENR,kBAAAA,IAAI,EAAEO,GAAG,CAACZ,MAAJ,CAAWK,IAFX;AAGNS,kBAAAA,MAAM,EAAEF,GAAG,CAACZ,MAAJ,CAAWe;AAHb,iBAjBb;;AAAA;AAAA;AAAA;AAuBMC,gBAAAA,OAAO,CAACD,GAAR,CAAY,0CAAZ;;AAvBN;AAyBKP,gBAAAA,CAAC;AAzBN;AAAA,uBA0BW,kBAAM,IAAN,CA1BX;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,O;;;;;;;;;;;EAJkDS,+B","sourcesContent":["import { SigningStargateClient } from '@cosmjs/stargate'\nimport { sha256 } from '@cosmjs/crypto'\nimport { sleep } from '@cosmjs/utils'\n\n// This is a wrapper around SigningStargateClient that waits up to an additional 1 minute for a Tx to be committed regardless of rpc endpoint timeout response\n\nexport default class StarportSigningClient extends SigningStargateClient {\n\tasync signAndBroadcast(signerAddress, messages, fee, memo = '') {\n\t\treturn super.signAndBroadcast(signerAddress, messages, fee, memo)\n\t}\n\tasync broadcastTx(tx) {\n\t\tlet result\n\t\ttry {\n\t\t\tresult = await super.broadcastTx(tx)\n\t\t\treturn result\n\t\t} catch (e) {\n\t\t\ttry {\n\t\t\t\tlet error = JSON.parse(e.message)\n\t\t\t\tif (error.code == -32603 && error.data == 'timed out waiting for tx to be included in a block') {\n\t\t\t\t\tlet txHash = sha256(tx)\n\t\t\t\t\tlet i = 0\n\t\t\t\t\twhile (i < 20) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tlet res = await this.tmClient.tx({\n\t\t\t\t\t\t\t\thash: txHash,\n\t\t\t\t\t\t\t\tprove: true,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\theight: res.height,\n\t\t\t\t\t\t\t\tcode: res.result.code,\n\t\t\t\t\t\t\t\trawLog: res.result.log,\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\tconsole.log('Waiting for tx to be included in a block')\n\t\t\t\t\t\t}\n\t\t\t\t\t\ti++\n\t\t\t\t\t\tawait sleep(3000)\n\t\t\t\t\t}\n\t\t\t\t\tthrow e\n\t\t\t\t} else {\n\t\t\t\t\tthrow e\n\t\t\t\t}\n\t\t\t} catch (notjson) {\n\t\t\t\tthrow e\n\t\t\t}\n\t\t}\n\t}\n}\n"],"file":"starportSigningClient.js"}